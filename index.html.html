<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Consulta Status - Wellhub</title>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <style>
    :root{
      --wellhub-red:#d8232a;
      --muted:#6b7280;
      --card-bg:#ffffff;
      --page-bg:#f4f6f8;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: 'Segoe UI', Roboto, Arial, sans-serif;
      background:var(--page-bg);
      color:#111827;
      display:flex;
      min-height:100vh;
      align-items:flex-start;
      justify-content:center;
      padding:28px 16px;
    }
    header{
      width:100%;
      max-width:900px;
      background:var(--wellhub-red);
      color:white;
      padding:18px 22px;
      border-radius:10px;
      box-shadow:0 4px 14px rgba(0,0,0,0.08);
      font-weight:700;
      letter-spacing:0.6px;
      margin-bottom:18px;
      text-align:center;
    }
    main{
      width:100%;
      max-width:900px;
      background:var(--card-bg);
      border-radius:10px;
      padding:24px;
      box-shadow:0 6px 20px rgba(0,0,0,0.06);
    }
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:center}
    input[type="text"]{
      padding:12px 14px;
      border-radius:8px;
      border:1px solid #d1d5db;
      width:360px;
      max-width:100%;
      font-size:14px;
    }
    button{
      background:var(--wellhub-red);
      color:white;
      border:none;
      padding:12px 18px;
      border-radius:8px;
      cursor:pointer;
      font-weight:600;
    }
    button.secondary{
      background:#374151;
    }
    #mensagemUpload{margin-top:12px;font-weight:600;color:var(--muted);display:block}
    #resultado{margin-top:20px;padding:18px;border-radius:10px;display:none;font-weight:700}
    .verde{background:#e8f8ef;color:#1b5e20;border:1px solid #66bb6a;}
    .vermelho{background:#fff1f2;color:#7f1d1d;border:1px solid #fca5a5;}
    .laranja{background:#fff7ed;color:#9a3412;border:1px solid #ffcc80;}
    .azul{background:#eaf2ff;color:#0f4c81;border:1px solid #90cdf4;}
    .amarelo{background:#fffce8;color:#7c2d12;border:1px solid #fde68a;}
    .emoji{font-size:34px;margin-bottom:8px}
    footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px;padding:10px}
    a{color:var(--wellhub-red);text-decoration:underline}
    .small{font-size:13px;color:var(--muted);font-weight:600}
    @media (max-width:560px){
      input[type="text"]{width:100%}
    }
  </style>
</head>
<body>
  <header>Consulta de Status - Wellhub</header>
  <main>
    <div style="text-align:center">
      <div class="small">A base ser√° carregada automaticamente ao abrir a p√°gina.</div>
      <div style="margin-top:10px" class="row">
        <input type="text" id="cnpjInput" placeholder="Digite o CNPJ (somente n√∫meros)">
        <button id="consultarBtn">Consultar</button>
        <button id="carregarBtn" class="secondary" title="For√ßar recarregar base">Recarregar base</button>
      </div>
      <div id="mensagemUpload">Carregando base...</div>
    </div>

    <div id="resultado"></div>
  </main>

  <footer>¬© 2025 Wellhub - Consulta Corporativa - criado por Equipe Suporte Staff</footer>

  <script>
    const ONEDRIVE_LINK = "https://1drv.ms/x/c/83f84c781abb7188/EVC7mGsP81dIpBYIw8fedw8BbxUDjdA3l9_O2n2mRQo7Xg?e=rq7UjS";

    let dados = [];

    function mostraMensagem(text, isError=false){
      const el = document.getElementById('mensagemUpload');
      el.textContent = text;
      el.style.color = isError ? '#b91c1c' : '#1f6f3b';
    }

    async function carregarCSVDeOneDrive(){
      mostraMensagem('Carregando base do OneDrive...');
      try{
        const resp = await fetch(ONEDRIVE_LINK, {cache: "no-store"});
        if(!resp.ok) throw new Error('Erro ao acessar o link: ' + resp.status);
        const text = await resp.text();
        if(text.includes(',')){
          parseCSV(text);
          mostraMensagem('Base carregada com sucesso. Registros: ' + dados.length);
        } else {
          mostraMensagem('O link n√£o retornou CSV v√°lido.', true);
        }
      }catch(err){
        console.error(err);
        mostraMensagem('Erro: ' + err.message, true);
      }
    }

    function parseCSV(text){
      const linhas = text.split(/\r?\n/).filter(l=>l.trim()!=="");
      dados = [];
      for(let i=1;i<linhas.length;i++){
        const colunas = linhas[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(c=>c.replace(/['"]+/g,'').trim());
        if(colunas.length>=4){
          const cnpj = colunas[2].replace(/\D/g,'').padStart(14,'0');
          if(cnpj.length===14){
            dados.push({data:colunas[0], empresa:colunas[1], cnpj:cnpj, status:colunas[3]});
          }
        }
      }
    }

    function mostrarResultado(registro){
      const div = document.getElementById('resultado');
      if(!registro){ div.style.display='block'; div.className='vermelho'; div.innerHTML='‚ùå CNPJ n√£o encontrado na base.'; return; }
      const status = String(registro.status).toLowerCase();
      let classe='', emoji='';
      if(status.includes('acesso liberado')){ classe='verde'; emoji='üü¢' }
      else if(status.includes('no go')){ classe='vermelho'; emoji='üî¥' }
      else if(status.includes('cancelada')){ classe='laranja'; emoji='üü†' }
      else if(status.includes('duplicada')){ classe='azul'; emoji='üîµ' }
      else if(status.includes('em cria√ß√£o') || status.includes('ap√≥s data corte')){ classe='amarelo'; emoji='üü°' }
      else { classe='vermelho'; emoji='‚ùå' }

      let extra='';
      if(status.includes('cancelada')){
        extra = '<br><br>‚ö†Ô∏è Procure o time <strong>Staff Suporte</strong>: <a href="https://teams.microsoft.com" target="_blank">Abrir sala no Teams</a>';
      }

      div.style.display='block';
      div.className = classe;
      div.innerHTML = '<div class="emoji">'+emoji+'</div>' +
                      '<div><strong>Empresa:</strong> '+registro.empresa+'<br>' +
                      '<strong>Status:</strong> '+registro.status + extra + '</div>';
      div.scrollIntoView({behavior:'smooth'});
    }

    function consultarCNPJ(){
      const input = document.getElementById('cnpjInput').value;
      const cnpjInput = input.replace(/\D/g,'').padStart(14,'0');
      const resultadoDiv = document.getElementById('resultado');
      if(!cnpjInput || cnpjInput.length!==14){
        resultadoDiv.style.display='block'; resultadoDiv.className='vermelho';
        resultadoDiv.innerHTML='‚ö†Ô∏è Digite um CNPJ v√°lido com 14 d√≠gitos.'; return;
      }
      const registro = dados.find(item=>item.cnpj===cnpjInput);
      mostrarResultado(registro);
    }

    document.getElementById('consultarBtn').addEventListener('click', consultarCNPJ);
    document.getElementById('cnpjInput').addEventListener('keydown', e => { if(e.key==='Enter'){ e.preventDefault(); consultarCNPJ(); }});
    document.getElementById('carregarBtn').addEventListener('click', carregarCSVDeOneDrive);

    window.addEventListener('load', carregarCSVDeOneDrive);
  </script>
</body>
</html>
